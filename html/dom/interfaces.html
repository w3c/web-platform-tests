<!doctype html>
<meta charset=utf-8>
<!-- WARNING: These tests are preliminary and probably partly incorrect.  -->
<title>HTML IDL tests</title>
<meta name=timeout content=long>
<script src=/resources/testharness.js></script>
<script src=/resources/testharnessreport.js></script>
<script src=/resources/WebIDLParser.js></script>
<script src=/resources/idlharness.js></script>

<h1>HTML IDL tests</h1>
<div id=log></div>

<script>
"use strict";
var iframe; // used to get a Document object (can't use `document` because some test clears the page)
setup(function() {
  iframe = document.createElement('iframe');
  iframe.hidden = true;
  document.body.appendChild(iframe);
});

function doTest([html, dom]) {
  var idlArray = new IdlArray();
  idlArray.add_untested_idls(dom);
  idlArray.add_idls(html);

  idlArray.add_objects({
    HTMLAllCollection: ['document.all'],
    Document: ['iframe.contentDocument', 'new Document()'],
  });
  idlArray.test();
};

function fetchData(url) {
  return fetch(url).then((response) => response.text());
}

function waitForLoad() {
  return new Promise(function(resolve) {
    addEventListener("load", resolve);
  });
}

promise_test(function() {
  // Have to wait for onload
  return Promise.all([fetchData("/interfaces/html.idl"),
                      fetchData("/interfaces/dom.idl"),
                      waitForLoad()])
                .then(doTest);
}, "Test driver");

</script>
