<!DOCTYPE html>
<meta charset="utf-8">
<title>The constraint validation API Test: element.validity.patternMismatch</title>
<link rel="author" title="Intel" href="http://www.intel.com/">
<link rel="help" href="http://www.w3.org/TR/2012/CR-html5-20121217/forms.html#dom-validitystate-stepmismatch">
<link rel="help" href="http://www.w3.org/TR/2012/CR-html5-20121217/forms.html#the-constraint-validation-api">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="support/validator.js"></script>
<div id="log"></div>
<form name="fm"></form>
<script>
  //set step = 2 * default step * factor
  var testElements = [
    {
      tag: "input",
      types: ["datetime"],
      testData: [
        {step: "", value: "2000-01-01T12:00:00Z", expected: false, name: "The step attribute is not set"},
        {step: 2 * 60 * 1000, value: "", expected: false, name: "The value attibute is empty string"},
        {step: 2 * 60 * 1000, value: "2000-01-01T12:58Z", expected: false, name: "The value must match the step"},
        {step: 2 * 60 * 1000, value: "2000-01-01T12:59Z", expected: true, name: "The value must mismatch the step"}
      ]
    },
    {
      tag: "input",
      types: ["date"],
      testData: [
        {step: "", value: "2000-01-01", expected: false, name: "The step attribute is not set"},
        {step: 2 * 1 * 86400000, value: "", expected: false, name: "The value attibute is empty string"},
        {step: 2 * 1 * 86400000, value: "1970-01-02", expected: false, name: "The value must match the step"},
        {step: 2 * 1 * 86400000, value: "1970-01-03", expected: true, name: "The value must mismatch the step"}
      ]
    },
    {
      tag: "input",
      types: ["month"],
      testData: [
        {step: "", value: "2000-01", expected: false, name: "The step attribute is not set"},
        {step: 2 * 1 * 1, value: "", expected: false, name: "The value attibute is empty string"},
        {step: 2 * 1 * 1, value: "1970-03", expected: false, name: "The value must match the step"},
        {step: 2 * 1 * 1, value: "1970-04", expected: true, name: "The value must mismatch the step"}
      ]
    },
    {
      tag: "input",
      types: ["week"],
      testData: [
        {step: "", value: "1970-W01", expected: false, name: "The step attribute is not set"},
        {step: 2 * 1 * 604800000, value: "", expected: false, name: "The value attibute is empty string"},
        {step: 2 * 1 * 604800000, value: "1970-W03", expected: false, name: "The value must match the step"},
        {step: 2 * 1 * 604800000, value: "1970-W04", expected: true, name: "The value must mismatch the step"}
      ]
    },
    {
      tag: "input",
      types: ["time"],
      testData: [
        {step: "", value: "12:00:00", expected: false, name: "The step attribute is not set"},
        {step: 2 * 60 * 1000, value: "", expected: false, name: "The value attibute is empty string"},
        {step: 2 * 60 * 1000, value: "12:02:00", expected: false, name: "The value must match the step"},
        {step: 2 * 60 * 1000, value: "12:03:00", expected: true, name: "The value must mismatch the step"}
      ]
    },
    {
      tag: "input",
      types: ["datetime-local"],
      testData: [
        {step: "", value: "2000-01-01T12:00:00", expected: false, name: "The step attribute is not set"},
        {step: 2 * 60 * 1000, value: "", expected: false, name: "The value attibute is empty string"},
        {step: 2 * 60 * 1000, value: "1970-01-01T12:02:00", expected: false, name: "The value must match the step"},
        {step: 2 * 60 * 1000, value: "1970-01-01T12:03:00", expected: true, name: "The value must mismatch the step"}
      ]
    },
    {
      tag: "input",
      types: ["number", "range"],
      testData: [
        {step: "", value: "1", expected: false, name: "The step attribute is not set"},
        {step: 2 * 1 * 1, value: "", expected: false, name: "The value attibute is empty string"},
        {step: 2 * 1 * 1, value: "2", expected: false, name: "The value must match the step"},
        {step: 2 * 1 * 1, value: "3", expected: true, name: "The value must mismatch the step"}
      ]
    }
  ];

  for (var i = 0; i < testElements.length; i++) {
    var ele = document.createElement(testElements[i].tag);
    if (testElements[i].types.length > 0) {
      for (var typ in testElements[i].types) {
        try {
          ele.type = testElements[i].types[typ];
        } catch (e) {
          //Do nothing, avoid the runtime error breaking the test
        }

        if (ele.type != testElements[i].types[typ]) {
          validator.test_support_type(
            ele,
            testElements[i].types[typ],
            "The " + testElements[i].types[typ] + " type of " + ele.tagName.toUpperCase() + " element must be suppoorted."
          );
          continue;
        }

        for (var item in testElements[i].testData) {
          validator.test_stepMismatch(
            ele,
            testElements[i].testData[item].step,
            testElements[i].testData[item].value,
            testElements[i].testData[item].expected,
            "[" + testElements[i].tag.toUpperCase() + " in " + testElements[i].types[typ].toUpperCase() + " status]: " + testElements[i].testData[item].name
          );
        }
      }
    } else {
      for (var item in testElements[i].testData) {
        validator.test_stepMismatch(
          ele,
          testElements[i].testData[item].pattern,
          testElements[i].testData[item].value,
          testElements[i].testData[item].expected,
          "[" + testElements[i].tag + "] " + testElements[i].testData[item].name
        );
      }
    }
  }
</script>
