<!doctype html>
<html>
  <head>
    <title>getUserMedia: Non-Interactive test for mediaDevices APIs</title>
    <link rel="author" title="Dr Alex Gouaillard" href="mailto:agouaillard@gmail.com"/>
    <link rel="help" href="http://w3c.github.io/mediacapture-main/getusermedia.html#mediadevices">
    <link rel="help" href="http://w3c.github.io/mediacapture-main/getusermedia.html#mediadevices-interface-extensions">
    <meta name='assert' content='Check the mediaDevices APIs.'/>
  </head>
  <body>
    <h1 class="instructions">Description</h1>
    <p class="instructions">This test checks for the presence of the
    <code>navigator.mediaDevices.getUserMedia</code> method.</p>
    <div id='log'></div>
    <script src=/resources/testharness.js></script>
    <script src=/resources/testharnessreport.js></script>
    <script src=/resources/WebIDLParser.js></script>
    <script src=/resources/idlharness.js></script>
    <script>
      var idl_array = new IdlArray();

      // dummies
      idl_array.add_untested_idls("interface EventTarget {};");
      idl_array.add_untested_idls("interface Navigator {};");

      idl_array.add_untested_idls("\
        [exposed=Window, NoInterfaceObject]\
        interface NavigatorUserMedia {\
          [SameObject]\
          readonly attribute MediaDevices mediaDevices;\
      };");

      idl_array.add_idls("\
        Navigator implements NavigatorUserMedia;\
      ")

      idl_array.add_idls("\
        [Exposed=Window]\
        interface MediaDevices : EventTarget {\
          attribute EventHandler ondevicechange;\
          Promise<sequence<MediaDeviceInfo>> enumerateDevices ();\
      };");

      // NOTE ALEX: slightly simplified to avoid bringing in too much
      idl_array.add_idls("\
        dictionary MediaStreamConstraints {\
          boolean video = false;\
          boolean audio = false;\
      };")

      idl_array.add_idls("\
        partial interface MediaDevices {\
          MediaTrackSupportedConstraints getSupportedConstraints ();\
          Promise<MediaStream> getUserMedia (MediaStreamConstraints constraints);\
      };");

      idl_array.add_objects({"Navigator": ["navigator"]});
      idl_array.add_objects({"MediaDevices":["navigator.mediaDevices"]});
      idl_array.test();
      done();

    </script>
  </body>
</html>
