<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Resource Timing object reload - back button navigation</title>
<script>
    function verify_iframe_reload_not_observable() {
        let entries = performance.getEntriesByType("resource");
        let found_first_iframe = false;
        console.log(entries);
        for (entry of entries) {
            if (entry.name == "{{location[scheme]}}://{{host]}}:{{ports[http][0]}}/resource-timing/resources/iframe-that-reloads.html") {
                found_first_iframe = true;
            }
            if (entry.name == "{{location[scheme]}}://{{host]}}:{{ports[http][0]}}/resource-timing/resources/reloaded_iframe.html") {
                opener.postMessage("FAIL - reloaded iframe exposed", "*");
                return;
            }
        }
        if (found_first_iframe) {
            opener.postMessage("FAIL - first iframe exposed", "*");
            return;
        }
        opener.postMessage("PASS", "*");
    }
    window.addEventListener("message", e=>{
        if (e.data == "reloaded") {
            if (sessionStorage.navigated) {
                delete sessionStorage.navigated;
                verify_iframe_reload_not_observable();
            } else {
                sessionStorage.navigated = true;
                setTimeout(() => {
                    history.pushState({}, "", "object-reload-back.sub.html");
                    location.href="navigate_back.html";
                }, 0);
            }
        }
    });
</script>
<object type="text/html" data="{{location[scheme]}}://{{host]}}:{{ports[http][0]}}/resource-timing/resources/iframe-that-reloads.html">
